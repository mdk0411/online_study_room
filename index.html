
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã¨ã´ã‚ã‚ªãƒ³ãƒ©ã‚¤ãƒ³è‡ªç¿’å®¤</title>
  <style>
    body {
      font-family: "Hiragino Maru Gothic ProN", sans-serif;
      background-color: #fff8f0;
      text-align: center;
      padding: 30px;
    }
    h1 {
      font-size: 2.5em;
      color: #ff9800;
    }
    .classroom {
      display: grid;
      grid-template-columns: repeat(4, 100px);
      grid-auto-rows: 100px;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
    }
    .seat {
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #999;
      border-radius: 10px;
      background-color: #ffffff;
      cursor: pointer;
      transition: 0.3s;
      font-weight: bold;
      font-size: 1em;
    }
    .seat.online {
      background-color: #c8f7c5;
    }
    .popup-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.3);
      display: none;
      justify-content: center;
      align-items: center;
    }
    .popup {
      background: #fff;
      padding: 20px 30px;
      border-radius: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      text-align: center;
    }
    .popup p {
      margin-bottom: 15px;
      font-size: 1.2em;
    }
    .popup button {
      padding: 10px 20px;
      font-size: 1em;
      margin: 5px;
      cursor: pointer;
    }
    .close-btn {
      background-color: #ddd;
    }
  </style>
</head>
<body>
  <h1>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³è‡ªç¿’å®¤</h1>
  <p>è‡ªåˆ†ã®å¸­ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€Œå…¥å®¤ / é€€å®¤ã€</p>
  <div class="classroom" id="classroom">
    <div class="seat" data-name="æ³‰">æ³‰</div>
    <div class="seat" data-name="æŠ¼å±±">æŠ¼å±±</div>
    <div class="seat" data-name="é«˜æœ¨">é«˜æœ¨</div>
    <div class="seat" data-name="å €" data-hori="true">å €</div>
    <div class="seat" data-name="å¤§æ´¥">å¤§æ´¥</div>
    <div class="seat" data-name="æ²³åˆ">æ²³åˆ</div>
    <div class="seat" data-name="å¹³é–“">å¹³é–“</div>
    <div class="seat" data-name="å—">å—</div>
    <div class="seat" data-name="æ²³å³¶">æ²³å³¶</div>
    <div class="seat" data-name="å·å£">å·å£</div>
    <div class="seat" data-name="å¤§çŸ¢">å¤§çŸ¢</div>
    <div class="seat" data-name="å±±å£">å±±å£</div>
  </div>

  <div class="popup-overlay" id="popupOverlay">
    <div class="popup">
      <p id="popupName"></p>
      <div id="popupButtons">
        <button onclick="updateStatus(true)">å…¥å®¤ğŸŸ¢</button>
        <button onclick="updateStatus(false)">é€€å®¤âšª</button>
      </div>
      <button class="close-btn" onclick="closePopup()">é–‰ã˜ã‚‹</button>
    </div>
  </div>

  <script>
    let currentSeat = null;
    const messages = [
      "ãŒã‚“ã°ã£ã¦ã¾ã™ã­ã€‚",
      "ä¸€ç™ºåˆæ ¼ã‚ã–ã—ã¦ãã ã•ã„ã€‚",
      "ãªã‚“ã§ã™ã‹ï¼Ÿ",
      "ãªã‚“ã§ã™ã‹ï¼ŸçœŸé¢ç›®ã«ã‚„ã£ã¦ãã ã•ã„ã€‚",
      "ãŸã¾ã«ã¯ä¼‘æ†©ã—ã¦ãã ã•ã„ã­ã€‚",
      "â€¦â€¦â€¦ï¾“ï½¸ï¾ï¾“ï½¸ï¾ï¼ˆè“å­ãƒ‘ãƒ³é£Ÿã¹ã¦ã‚‹ï¼‰",
      "ã¼ããƒ›ãƒªã‚¨ãƒ¢ãƒ³",
      "æ³‰ã•ã‚“ã¯é¢å€’è¦‹ãŒã„ã„ã§ã™ã­ã€‚",
      "å¤§æ´¥ã•ã‚“ã€æ¯å›ã€æ—¥ç›´ã§è‰¯ã„ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã—ã¦ãã‚Œã¾ã™ã­ã€‚",
      "å¤§çŸ¢ãƒªãƒ¼ãƒ€ãƒ¼ã€å ±å‘Šã—ã¦ãã ã•ã„ã€‚",
      "æŠ¼å±±ã•ã‚“ã€ã„ã¤ã‚‚ã‚»ãƒ³ã‚¿ãƒ¼ã«åº§ã£ã¦ã€å¯ãšã«èã„ã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ã­ã€‚",
      "æ²³åˆã•ã‚“ã€æœ€è¿‘ã€è‡ªåˆ†ã§ã‚¨ãƒ©ãƒ¼è§£æ±ºã—ã¦å‰ã„ã§ã™ã­ã€‚",
      "å·å£ã•ã‚“ã€ã‚ã®ä»¶ã§ã¡ã‚‡ã£ã¨ãŠè©±ãŒã€‚",
      "æ²³å³¶ã•ã‚“ã€å—è¬›è¨¼æ˜æ›¸ã®æ›¸ãæ–¹ã€ã‚ã‹ã£ã¦ãªã„ã§ã™ã­ã€‚",
      "é«˜æœ¨ã•ã‚“ã€ã„ã¤ã‚‚ç›®ç·šã‚’åˆã‚ã›ã¦ç†±å¿ƒã«èã„ã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ã­ã€‚",
      "å¹³é–“ã•ã‚“ã€ã¡ã‚‡ã£ã¨ã“ã®å¾Œã„ã„ã§ã™ã‹ï¼Ÿ",
      "å—ã•ã‚“ã¯ã„ã¤ã‚‚è¿½è©¦ãŒãªãã¦ã™ã”ã„ã§ã™ã­ã€‚",
      "å±±å£ã•ã‚“ã¯"
    ];

   
    document.querySelectorAll('.seat').forEach(seat => {
      seat.addEventListener('click', () => {
        currentSeat = seat;
        const popup = document.getElementById('popupOverlay');
        const popupName = document.getElementById('popupName');
        const popupButtons = document.getElementById('popupButtons');

        if (seat.dataset.hori === "true") {
          const randomMsg = messages[Math.floor(Math.random() * messages.length)];
          popupName.innerText = "å €ã€Œ" + randomMsg + "ã€";
          popupButtons.style.display = "none";
        } else {
          popupName.innerText = seat.dataset.name + " ã•ã‚“ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã™";
          popupButtons.style.display = "block";
        }

        popup.style.display = 'flex';
      });
    });

    function updateStatus(isOnline) {
      if (currentSeat && currentSeat.dataset.hori !== "true") {
        const name = currentSeat.dataset.name;
        updateFirebaseStatus(name, isOnline);

        if (isOnline) {
          currentSeat.classList.add('online');
        } else {
          currentSeat.classList.remove('online');
        }
        closePopup();
      }
    }

    function closePopup() {
      document.getElementById('popupOverlay').style.display = 'none';
    }
  </script>
  <!-- ã“ã“ã‹ã‚‰ Firebaseã®ã‚³ãƒ¼ãƒ‰ -->
<script type="module">
  // âœ… import ã¯ä¸€ç•ªä¸Šã§ã¾ã¨ã‚ã¦å®£è¨€ï¼
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  // import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
  import { getDatabase, ref, set, onValue, push, query, limitToLast } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  // ğŸ”§ Firebase åˆæœŸåŒ–
  const firebaseConfig = {
    apiKey: "AIzaSyAokDXuZsin37pdrIn-rJCPNhhUxOwlzM",
    authDomain: "topia-online-study.firebaseapp.com",
    databaseURL: "https://topia-online-study-default-rtdb.firebaseio.com",
    projectId: "topia-online-study",
    storageBucket: "topia-online-study.appspot.com",
    messagingSenderId: "646481189423",
    appId: "1:646481189423:web:6623b8828652490236c4da",
    measurementId: "G-ZRCJN56SNM"
  };

  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);

  // âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
  const statusRef = ref(database, 'seats');
  onValue(statusRef, (snapshot) => {
    const data = snapshot.val();
    if (!data) return;

    document.querySelectorAll('.seat').forEach(seat => {
      seat.classList.remove('online');
    });

    Object.entries(data).forEach(([name, status]) => {
      if (status === "online") {
        const seat = document.querySelector(`.seat[data-name="${name}"]`);
        if (seat) seat.classList.add('online');
      }
    });
  });
window.addEventListener("DOMContentLoaded", () => {
  //const logsRef = query(ref(database, 'logs'), limitToLast(10));
  onValue(logsRef, (snapshot) => {
    const logs = [];
    snapshot.forEach(child => {
      logs.push(child.val());
    });
    logs.reverse();

    const logList = document.getElementById('logList');
    if (!logList) return; // å®‰å…¨ã‚¬ãƒ¼ãƒ‰

    logList.innerHTML = '';
    logs.forEach(log => {
      const date = new Date(log.timestamp);
      const timeStr = date.toLocaleString("ja-JP", {
        year: 'numeric', month: '2-digit', day: '2-digit',
        hour: '2-digit', minute: '2-digit'
      });
      const li = document.createElement('li');
      li.textContent = `ğŸ•’ ${timeStr}ã€€${log.name}ã•ã‚“ãŒ${log.status}ã—ã¾ã—ãŸ`;
      logList.appendChild(li);
    });
  });
});

  // âœ… æ›¸ãè¾¼ã¿é–¢æ•°
 window.updateFirebaseStatus = function(name, isOnline) {
   logEntry(name, isOnline ? "å…¥å®¤" : "é€€å®¤");
    const statusRef = ref(database, 'seats/' + name);
    set(statusRef, isOnline ? "online" : "offline");
  }
  // âœ… ãƒ­ã‚°
  function logEntry(name, status) {
  const timestamp = new Date().toISOString();
  const logRef = ref(database, 'logs');
  const newLogRef = push(logRef);
  set(newLogRef, {
    name: name,
    status: status,
    timestamp: timestamp
  });
}
  const logsRef = query(ref(database, 'logs'), limitToLast(10));
onValue(logsRef, (snapshot) => {
  const logs = [];
  snapshot.forEach(child => {
    logs.push(child.val());
  });
  logs.reverse(); // æœ€æ–°é †ã«ä¸¦ã³æ›¿ãˆ

  const logList = document.getElementById('logList');
  logList.innerHTML = '';

  logs.forEach(log => {
    const date = new Date(log.timestamp);
    const timeStr = date.toLocaleString("ja-JP", {
      year: 'numeric', month: '2-digit', day: '2-digit',
      hour: '2-digit', minute: '2-digit'
    });
    const li = document.createElement('li');
    li.textContent = `ğŸ•’ ${timeStr}ã€€${log.name}ã•ã‚“ãŒ${log.status}ã—ã¾ã—ãŸ`;
    logList.appendChild(li);
  });
});
<!-- ãƒ­ã‚°è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
<div id="logArea" style="
  margin-top: 40px;
  padding: 15px;
  background-color: #fff2e6;
  border: 1px solid #ccc;
  border-radius: 10px;
  width: 90%;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
  text-align: left;
  font-size: 0.95em;
  line-height: 1.6;
  color: #333;
">
  <strong>ğŸ“œ å…¥é€€å®¤ãƒ­ã‚°ï¼ˆæœ€æ–°10ä»¶ï¼‰</strong>
  <ul id="logList" style="list-style: none; padding-left: 0;"></ul>
</div>
</script>

<!-- ã“ã“ã¾ã§ Firebaseã®ã‚³ãƒ¼ãƒ‰ -->

</body>
</html>
